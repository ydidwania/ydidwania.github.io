<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Yashvardhan-GSoC Week 8 : Debug, Code, Debug</title>
  <meta name="description" content="With the new events coming up good, it was time to see how the two parts work together. Since I did not write any code in the 1st week of July, this week was...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2018/07/16/gsoc-week-8.html">
  <link rel="alternate" type="application/rss+xml" title="Yashvardhan Didwania" href="/feed.xml">
  <link rel="icon" href="http://localhost:4000/favicon.ico" />



  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Yashvardhan Didwania</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
            <a class="page-link" href="/blog/">Blog</a>
            
          
            
            
            <a class="page-link" href="/">About</a>
            
          
            
            
          
            
            
            <a class="page-link" href="/projects">Projects</a>
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">GSoC Week 8 : Debug, Code, Debug</h1>
    <p class="post-meta">
      <time datetime="2018-07-16T09:00:00+05:30" itemprop="datePublished">
        
        Jul 16, 2018
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>With the new events coming up good, it was time to see how the two parts work together. Since I did not write any code in the 1st week of July, this week was more about getting things done quickly.</p>

<h2 id="the-new-listeners-component">The new Listeners Component</h2>

<p>My <a href="https://github.com/taskcluster/taskcluster-events/pull/7">PR</a> was finally merged after a few minor changes. Now the events server sends the entire message to the client instead of only <code class="highlighter-rouge">message.payload</code>. This gives them additional information to work with like the <code class="highlighter-rouge">exchange</code> and <code class="highlighter-rouge">routes</code> of the message. I also opened another <a href="https://github.com/taskcluster/taskcluster-events/pull/8/">PR</a> for slight changes while I worked on <code class="highlighter-rouge">tc-tools</code></p>

<h2 id="getting-the-client-ready">Getting the client ready</h2>

<p>This involved making quite a few decisions, so I was quite active and talking to the guys on IRC. Conventionally, <code class="highlighter-rouge">pulse-inspector</code> used <a href="https://github.com/taskcluster/taskcluster-client-web"><code class="highlighter-rouge">tc-client-web</code></a> which exposed a <code class="highlighter-rouge">WebListener</code> which in turn connected to <code class="highlighter-rouge">events.taskcluster.net</code>.
Since the client was simple to do, we decided its best to put <code class="highlighter-rouge">tc-tools</code> in direct contact with <code class="highlighter-rouge">tc-events</code>.</p>

<h2 id="trouble-with-headers">Trouble with headers</h2>

<p>The <code class="highlighter-rouge">EventSource</code> in <code class="highlighter-rouge">tc-tools</code> was setting the header <code class="highlighter-rouge">Cache-Control</code> on its own while <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Headers"><code class="highlighter-rouge">Access-Control-Allow-Headers</code></a> in the response did not include <code class="highlighter-rouge">Cache-Control</code>. This led to an error <code class="highlighter-rouge">Request header field Cache-Control is not allowed by Access-Control-Allow-Headers in preflight response</code>.</p>

<p>A preflight request is one made by browsers to make sure CORS protocol is respected. In other words it is asking the server if it allows certain operations to be performed. In my case the server did not allow <code class="highlighter-rouge">Cache-Control</code> to be set by the origin.</p>

<p>After some discussion, hassan made changes to <code class="highlighter-rouge">tc-lib-api</code>(v12.3) to add <code class="highlighter-rouge">Cache-Contol</code> in ACAH  in the preflight response. Everything was working fine..</p>

<h2 id="all-hell-breaks-loose">All hell breaks loose</h2>

<p>..until the <code class="highlighter-rouge">listener.resume</code> call started giving timeout randomly. I spent a considerable part of my time figuring this out, finally today I figured out it was my institute network causing the problem. It used to work fine at most times except a few hours each day when I would use it. This was after I added  <code class="highlighter-rouge">debug</code> statements in <code class="highlighter-rouge">node_modules</code> to see what was going on.</p>

<p>Meanwhile, <code class="highlighter-rouge">tc-lib-api</code> v12.3 introduced a minor bug, which was later fixed.</p>

<h2 id="coming-up">Coming up</h2>

<p>My <a href="https://github.com/taskcluster/taskcluster-tools/pull/544">PR</a> will most probably be merged next week. Then the final part of the project would be to get these things running in production. On the sides I also started with <a href="https://github.com/taskcluster/taskcluster-cli"><code class="highlighter-rouge">taskcluster-cli</code></a>. It is written in <code class="highlighter-rouge">go</code> and I am hoping to learn more about in the next week.</p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Yashvardhan Didwania</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              ydidwania
            
            </li>
            
            <li><a href="mailto:didwaniayashvardhan@gmail.com">didwaniayashvardhan@gmail.com</a></li>
            
        </ul>
      </div>
      <div class="footer-col footer-filler">
        <p> </p>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ydidwania"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">ydidwania</span></a>

          </li>
          

          
            <li>
              <a href="https://facebook.com/ydidwania"><span class="icon icon--facebook">
<svg  x="0px" y="0px" width="16px" height="16px" viewBox="0 0 90 90" style="enable-background:new 0 0 90 90;" xml:space="preserve">
<g>
    <path id="Facebook__x28_alt_x29_" d="M90,15.001C90,7.119,82.884,0,75,0H15C7.116,0,0,7.119,0,15.001v59.998   C0,82.881,7.116,90,15.001,90H45V56H34V41h11v-5.844C45,25.077,52.568,16,61.875,16H74v15H61.875C60.548,31,59,32.611,59,35.024V41   h15v15H59v34h16c7.884,0,15-7.119,15-15.001V15.001z" fill="#3A589B"/>
</g>
</svg></span><span class="username">ydidwania</span></a>

            </li>
          
        </ul>
      </div>
      <div class="footer-col footer-filler">
        <p> </p>
      </div>

      <div class="footer-col footer-col-3">
        <a href="https://github.com/ydidwania/ydidwania.github.io">Jekyll Source</a>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
